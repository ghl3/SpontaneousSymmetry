/* Import KaTeX styles - must be first */
@import "katex/dist/katex.min.css";

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== Base Layer ===== */
@layer base {
  html {
    scroll-behavior: smooth;
  }

  body {
    @apply font-sans text-text-primary bg-surface antialiased;
    font-size: 17px;
    line-height: 1.7;
  }

  /* Typography */
  h1, h2, h3, h4, h5, h6 {
    @apply text-text-primary font-semibold;
    letter-spacing: -0.01em;
  }

  h1 { @apply text-3xl md:text-4xl mb-4; }
  h2 { @apply text-2xl md:text-3xl mb-3; }
  h3 { @apply text-xl md:text-2xl mb-2; }

  /* Links */
  a {
    @apply text-accent no-underline transition-colors duration-150;
  }

  a:hover {
    @apply text-accent-dark;
  }

  /* Code */
  pre {
    @apply bg-code-bg rounded-lg p-4 my-4 overflow-x-auto font-mono text-sm leading-relaxed shadow-sm;
  }

  code {
    @apply font-mono text-[0.9em];
  }

  :not(pre) > code {
    @apply bg-code-bg px-1.5 py-0.5 rounded text-text-primary;
  }
}

/* ===== Component Layer ===== */
@layer components {
  /* Document container */
  .document {
    @apply w-full max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-6;
  }

  /* Section divider */
  .divider {
    @apply w-16 h-px bg-gradient-to-r from-transparent via-border to-transparent mx-auto my-8;
  }

  /* Post content - prose overrides */
  .post-content {
    @apply leading-relaxed;
  }

  /* Hide first h1 when page already has a header */
  .post-content.hide-first-h1 > h1:first-child {
    @apply hidden;
  }

  /* Tighter heading spacing */
  .post-content h2 {
    @apply mt-8 mb-3;
  }

  .post-content h3 {
    @apply mt-6 mb-2;
  }

  .post-content h4 {
    @apply mt-5 mb-2;
  }

  /* First heading after hidden h1 should have no top margin */
  .post-content.hide-first-h1 > h1:first-child + p + h2,
  .post-content.hide-first-h1 > h1:first-child + h2,
  .post-content > h2:first-child {
    @apply mt-0;
  }

  .post-content p {
    @apply mb-5;
  }

  .post-content ul,
  .post-content ol {
    @apply mb-4 pl-6;
  }

  .post-content li {
    @apply mb-1;
  }

  .post-content blockquote {
    @apply border-l-3 border-accent pl-4 my-4 text-text-secondary italic;
  }

  .post-content table {
    @apply border-collapse my-4 w-full;
  }

  .post-content th,
  .post-content td {
    @apply border border-border px-3 py-2 text-left;
  }

  .post-content th {
    @apply bg-surface font-semibold;
  }
}

/* ===== Syntax Highlighting ===== */
.hljs { @apply bg-code-bg; }
.hljs-comment, .hljs-quote { @apply text-text-secondary italic; }
.hljs-keyword, .hljs-selector-tag { @apply text-emerald-700 font-semibold; }
.hljs-number { @apply text-text-secondary; }
.hljs-string { @apply text-rose-700; }
.hljs-title, .hljs-section { @apply text-blue-700 font-semibold; }
.hljs-built_in, .hljs-builtin-name { @apply text-emerald-700; }
.hljs-attr, .hljs-attribute { @apply text-amber-700; }
.hljs-name, .hljs-tag { @apply text-emerald-700 font-semibold; }

/* ===== KaTeX Math Overrides ===== */
.katex-display {
  display: block !important;
  margin: 1em 0 !important;
  text-align: center;
  overflow-x: auto;
  overflow-y: hidden;
}

.katex {
  font-size: 1.1em;
}

/* Protect KaTeX from prose styling */
.prose .katex,
.prose .katex-display {
  font-size: 1.1em;
  line-height: normal;
}

.prose .katex-display > .katex {
  display: inline-block;
  text-align: center;
}

/* Reset prose styles on KaTeX elements */
.prose .katex .mord,
.prose .katex .mbin,
.prose .katex .mrel,
.prose .katex .mopen,
.prose .katex .mclose,
.prose .katex .mpunct,
.prose .katex .minner {
  color: inherit;
}

/* Ensure math spans don't get prose code styling */
.prose .katex-mathml {
  display: none;
}

.prose span.katex-html {
  background: none;
  padding: 0;
  border-radius: 0;
}

/* Inline math should flow with text */
.prose p .katex {
  display: inline;
}

/* ===== Utilities ===== */
@layer utilities {
  .border-l-3 {
    border-left-width: 3px;
  }
}
